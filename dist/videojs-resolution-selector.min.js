/*! videojs-resolution-selector - v0.1.2 - 2014-08-19
* Copyright (c) 2014 Dominic; Licensed MIT */
!function(a){var b={extend:function(a,c){for(var d in c)c.hasOwnProperty(d)&&(a[d]="object"==typeof c[d]&&null!==c[d]?b.extend(a[d]||{},c[d]):c[d]);return a},res_label:function(a){return/^\d+$/.test(a)?a+"p":a},matchResolution:function(){},buildCookiesDummy:function(){return{get:function(){return""},set:function(){return!1}}}};a.ResolutionMenuItem=a.MenuItem.extend({init:function(c,d){d.label=b.res_label(d.res),d.selected=d.res.toString()===c.getCurrentRes().toString(),a.MenuItem.call(this,c,d),this.resolution=d.res,this.on("click",this.onClick),c.on("changeRes",a.bind(this,function(){this.selected(this.resolution==c.getCurrentRes()?!0:!1)}))}}),a.ResolutionMenuItem.prototype.onClick=function(){var a=this.player(),c=a.el().firstChild,d=a.currentTime(),e=a.paused(),f=a.controlBar.resolutionSelector.el().firstChild.children,g=f.length;if(a.getCurrentRes()!=this.resolution){for("none"==c.preload&&(c.preload="metadata"),a.src(a.availableRes[this.resolution]).one("loadedmetadata",function(){a.currentTime(d),e||a.play()}),a.currentRes=this.resolution;g>0;)if(g--,"vjs-current-res"==f[g].className){f[g].innerHTML=b.res_label(this.resolution);break}a.trigger("changeRes")}},a.ResolutionTitleMenuItem=a.MenuItem.extend({init:function(b,c){a.MenuItem.call(this,b,c),this.off("click")}}),a.ResolutionSelector=a.MenuButton.extend({init:function(b,c){b.availableRes=c.available_res,a.MenuButton.call(this,b,c)}}),a.ResolutionSelector.prototype.createItems=function(){var b,c=this.player(),d=[];d.push(new a.ResolutionTitleMenuItem(c,{el:a.Component.prototype.createEl("li",{className:"vjs-menu-title vjs-res-menu-title",innerHTML:"Quality"})}));for(b in c.availableRes)"length"!=b&&d.push(new a.ResolutionMenuItem(c,{res:b}));return d.sort(function(a,b){return"undefined"==typeof a.resolution?-1:parseInt(b.resolution)-parseInt(a.resolution)}),d},a.plugin("resolutionSelector",function(c){if(this.el().firstChild.canPlayType){for(var d,e,f,g=this,h=g.options().sources,i=h.length,j=b.extend({default_res:"",force_types:!1},c||{}),k={length:0},l=j.default_res&&"string"==typeof j.default_res?j.default_res.split(","):[],m="videojs.resolutionSelector",n=m+".res",o="function"==typeof Cookies?Cookies:b.buildCookiesDummy();i>0;)i--,h[i]["data-res"]&&(e=h[i]["data-res"],"object"!=typeof k[e]&&(k[e]=[],k.length++),k[e].push(h[i]));if(j.force_types)for(e in k)if("length"!=e)for(i=j.force_types.length;i>0;){for(i--,d=k[e].length,found_types=0;d>0;)d--,j.force_types[i]===k[e][d].type&&found_types++;if(found_types<j.force_types.length){delete k[e],k.length--;break}}if(!(k.length<2)){var p=o.get(n);for(p&&(l=[p].concat(l)),i=0;i<l.length;i++)if(k[l[i]]){g.src(k[l[i]]),g.currentRes=l[i];break}g.getCurrentRes=function(){if("undefined"!=typeof g.currentRes)return g.currentRes;try{return res=g.options().sources[0]["data-res"]}catch(a){return""}},e=g.getCurrentRes(),e&&(e=b.res_label(e)),f=new a.ResolutionSelector(g,{el:a.Component.prototype.createEl(null,{className:"vjs-res-button vjs-menu-button vjs-control",innerHTML:'<div class="vjs-control-content"><span class="vjs-current-res">'+(e||"Quality")+"</span></div>",role:"button","aria-live":"polite",tabIndex:0}),available_res:k}),this.on("changeRes",function(){o.set(n,g.getCurrentRes())}),this.one("loadedmetadata",function(){var a=o.get(n);a&&(g.src(g.availableRes[a]),g.currentRes=a,g.trigger("changeRes"))}),g.controlBar.resolutionSelector=g.controlBar.addChild(f)}}})}(videojs);